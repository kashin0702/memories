### vuex-封装

```js
//  store/index.js主文件，通过module独立封装各个store子模块
import Vue from 'vue'
import Vuex from 'vuex'
import enums from './modules/enums'
import page from './modules/page'
import operator from './modules/operator'
Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    enums: enums,
    page: page,
    operator: operator
  }
})

```

modules 子模块:

```js
//module enums为例
import {
  //这些都是提前定义的一些常量字段
  ENUMS_GET_KEY_VALUE,
  ENUMS_GET_NAME,
  ENUMS_SET_DATA
} from '../mutation-types'

const state = {
  data: {} // 枚举值数据对象
}
//**getters相当于store的计算属性，接受state作为第一个参数
const getters = {
    //常量字段作为getters方法名
  [ENUMS_GET_KEY_VALUE] (state) {
    return typeCode => {
      let arr = []
      for (let i in state.data[typeCode]) {
        arr.push({
          key: state.data[typeCode][i].enumValue,
          value: state.data[typeCode][i].enumName
        })
      }
      return arr
    }
  },
  [ENUMS_GET_NAME] (state) {
    return (value, typeCode) => {
      for (let i in state.data[typeCode]) {
        if (state.data[typeCode][i].enumValue === value) {
          return state.data[typeCode][i].enumName
        }
      }
      return ''
    }
  }
}

const mutations = {
  [ENUMS_SET_DATA] (state, data) {
    state.data = data
  }
}

const actions = {}

export default {
  state,
  getters,
  mutations,
  actions
}
```

### api封装

```js
import axios from 'axios'
import router from '@/router'
import constant from '@/data/constant'
import {LocalStorageFactory} from '@/utils/localstorage.factory'

axios.defaults.withCredentials = true
axios.defaults.baseURL = window.config.baseUrl
axios.defaults.headers = {
  'Content-Type': 'application/json'
}

axios.interceptors.request.use(config => {
  let accessToken = LocalStorageFactory.get('ACCESS_TOKEN')
  // 如果没有accessToken且不在登录界面，则跳转到登录界面
  if (!accessToken && router.currentRoute.fullPath !== '/') {
    router.push('/')
  }
  config.headers.accessToken = accessToken
  return config
}, err => {
  return Promise.reject(err)
})

//通用api方法
function axiosApi (method, url, params, self, config, success, fail, error) {
  // 默认配置
  if (!config) {
    config = {
      loadingShow: false,
      loadingHide: false,
      loadingShowMsg: ''
    }
  }
  // 提示信息展示
  if (config.loadingShow) {
    window.isLoading = true
    self.$vux.loading.show({
      text: config.loadingShowMsg
    })
  }
  // 请求信息打印
  console.log(url)
  console.log(params)
  return axios({
    method: method,
    url: url,
    data: method === 'POST' || method === 'PUT' ? params : null,
    params: method === 'GET' || method === 'DELETE' ? params : null,
    withCredentials: true
  }).then(function (res) {
    window.isLoading = false
    // 提示信息隐藏
    if (config.loadingHide) {
      self.$vux.loading.hide()
    }
    if (res.data[window.config.RETURN_CODE] === window.config.SUCCESS_CODE || res.data[window.config.PAPERLESS_RETURN_CODE] === window.config.PAPERLESS_SUCCESS_CODE) {
      // 请求结果成功操作
      if (success) {
        success(res.data)
      }
    } else {
      // 请求结果失败操作
      if (fail) {
        fail(res.data)
      }
    }
    // 结果信息打印
    console.log(res)
  }).catch(function (err) {
    window.isLoading = false
    // 提示信息隐藏
    self.$vux.loading.hide()
    self.$vux.toast.show({
      text: constant.LOADING_MSG_NET_ERROR,
      width: '10em',
      type: 'text',
      position: 'top'
    })
    if (error) {
      // 请求异常操作
      error(err)
    }
    // 异常信息打印
    console.log(err)
  })
}

// 提供再次封装的GET、POST、PUT、DELETE方法
export default {
  get: function (url, params, self, config, success, fail, error) {
    return axiosApi('GET', url, params, self, config, success, fail, error)
  },
  post: function (url, params, self, config, success, fail, error) {
    return axiosApi('POST', url, params, self, config, success, fail, error)
  },
  put: function (url, params, self, config, success, fail, error) {
    return axiosApi('PUT', url, params, self, config, success, fail, error)
  },
  delete: function (url, params, self, config, success, fail, error) {
    return axiosApi('DELETE', url, params, self, config, success, fail, error)
  }
}
```

### 银行签约查询接口

```js
//api方法
pubBankQryEntrustZg :function(params, self, config, success, fail, error) {
    return ajax.post(eiOspAccountBasePath + '/pubBankQryEntrustZg', params, self, config, success, fail, error)
  },
      
 // vuex对象内的异步方法 store/modules/bankSign.js
 // 14.15 银行签约查询通用接口
const actions = {
     [BANK_SIGN_QUERY_ENTRUST] ({commit, rootState}, args) {
    return new Promise(function (resolve, reject) {
      eiOspAPI.pubBankQryEntrustZg(args.params, args.self, args.config, res => {
        resolve(res.data)
      }, err => {
        args.self.$vux.toast.show({
          text: err[window.config.RETURN_MESSAGE],
          width: '14em',
          type: 'text',
          position: 'top'
        })
        reject(err)
      })
    })
  },
 //14.13 银行解约通用接口
[BANK_SIGN_UNSIGN] ({commit, rootState}, args) {
    return new Promise(function (resolve, reject) {
      eiOspAPI.pubBankUnsignZg(args.params, args.self, args.config, res => {
        resolve(res.data)
      }, err => {
        args.self.$vux.toast.show({
          text: err[window.config.RETURN_MESSAGE],
          width: '14em',
          type: 'text',
          position: 'top'
        })
        reject(err)
      })
    })
  },
}
 
```

```js
//页面具体调用
this.BANK_SIGN_UNSIGN({
    params: {
      servId: self.prodInstId,
      bankId: self.orderParamInfo.bank,
      bankAcctId: self.orderParamInfo.bankNo
    },
    self: self,
    config: {
      loadingShow: true,
      loadingHide: true,
      loadingShowMsg: '正在解约，请稍候'
    }
  }).then(res => {
    if (res.retCode === '08') {
      // 解约不成功，仍然为原卡号
      self.params.bankNo = self.orderParamInfo.bankNo
      self.isReady = false
    } else {
      // gyf add 解约后删除servId
      self.ORDER_PARAM_DEL_PRODINSTID()
    }
  })
```



### 接口异步return 实例

```js
queryEntrust () {
  let self = this
  if (self.params.bankId === '604') {
    console.log('查询银行签约信息')
    // !important gyf add 此处添加return才能通过await获取true或false
    return self.BANK_SIGN_QUERY_ENTRUST({
      params: {
        bankId: self.collectionRelationList[self.collectionRelationIndex].bankCode,
        bankAcctId: self.collectionRelationList[self.collectionRelationIndex].bankAcctId,
        // gyf add 增加servId入参
        servId: self.collectionRelationList[self.collectionRelationIndex].servId
      },
      self: self,
      config: {
        loadingShow: true,
        loadingHide: true,
        loadingShowMsg: '正在查询银行签约信息'
      }
    }).then(res => {
      console.log('gyf签约查询', res)
      let temp = res.relationList.filter(item => {
        if (item.servId === self.prodInstId) {
          return item
        }
      })
      console.log('gyf筛选查询', temp)
      // self.validType = temp[0].state === '解约' ? '已失效' : ''
      // gyf add直接获取是否是正常的状态值
      self.distrust = temp[0].state === '正常'
      // 除了正常和解约的其他状态 都不调解约接口
      if (temp[0].state !== '正常' && temp[0].state !== '解约') {
        console.log('状态是其他中间值')
        self.$vux.toast.show({
          text: '原托收银行正在进行托收解约，请稍后再试',
          width: '22em',
          type: 'text',
          position: 'top'
        })
        self.validType = temp[0].state // 直接把状态值赋给validType
        return false
      } else if (temp[0].state === '解约') {
        self.validType = '已失效'
        // validType == 已失效 不执行后续解约操作 返回false
        self.params.agreementNo = res.agreeNo
        console.log('状态是解约')
        return false
      } else {
        // 正常状态 走解约流程
        return true
      }
      // return true
    }, error => {
      console.log(error)
      console.log('执行了error')
      self.$vux.toast.show({
        text: error.message,
        width: '22em',
        type: 'text',
        position: 'top'
      })
      console.log('执行了错误返回false')
      return false
    })
  }
},
```



### 接口调用例子

```js
//封装订单提交接口
export const payAPI = {
    createPayOrder (requestId, params, self, config, success, fail, error) {
    return ajax.post(payServerBasePath + '/createPayOrder/' + requestId, params, self, config, success, fail, error)
  },
}

//具体调用
payAPI.createPayOrder(self.payRequestId, {
    totalBizType: 'BIZ00846',
    userKind: '5',
    userNo: self.resultDetailOrderParamBo.pdfInfoBo.custCode,
    requestId: self.payRequestId,
    payVia: self.orderParamOther.payMethod === '25' ? '66' : '56',
    amount: self.resultDetailTotalReceipts,
    payChannel: self.orderParamOther.payMethod === '25' ? 'weixin_1' : 'alipay_3',
    payType: self.orderParamOther.payMethod,
    subject: '融合业务新装',
    useCouponCode: '101',
    parperOrderNo: self.resultDetailOrderParamBo.businessInfoBo.orderId
  }, self, {
    loadingShow: true,
    loadingHide: true,
    loadingShowMsg: '生成支付二维码'
  }, res => {
    if (self.broadbandIsHigh) {
      // 高宽带派单
      payAPI.highKd(self.payRequestId, {
        custId: self.customerList[self.customerIndex].custId,
        offerName: self.broadbandOfferName,
        custOrderId: self.resultDetailOrderParamBo.businessInfoBo.orderId,
        mobilePhone: self.broadbandPhone,
        remark: '',
        kindName: self.broadbandKindName
      }, self)
    }
    self.PAY_SET_QR_CODE(res.data.qrCode)
    self.PAY_SET_AMOUNT(res.data.sumPay)
    self.PAY_SET_TYPE(self.orderParamOther.payMethod === '25' ? '1' : '0')
    self.PAY_SET_PATH('/main/' + self.pageSelectTabKey)
    self.$router.push('/fusenew/qrcode/pay')
  }, err => {
        self.$vux.toast.show({
          text: err[window.config.PAPERLESS_RETURN_MESSAGE],
          width: '20em',
          type: 'text',
          position: 'top'
        })
    })
```

### 建行解约实例

```js
//点击获取验证码
async getAuthCode () {
  let self = this
  if (isEmpty(self.params.bankNo)) {
    self.$vux.toast.show({
      text: '请输入卡号',
      width: '10em',
      type: 'text',
      position: 'top'
    })
    return
  }
  // 选择同一家银行并不会触发on-change事件，所以在此进行解约
  self.isReady = true
  // gyf add 用户id不为空时触发解约
  if (self.orderParamInfo.bank === '604' && self.prodInstId !== '') {
    // 本来已签约建行 解约事件 点击验证码时触发
    await self.changeBankByAgreement()
  }
  if (!self.isReady) return
  // 调用crm封装的建行获取签约验证码接口，给客户手机上发签约验证码短信
  if (self.prodInstId === '') {
    // 获取预生成用户编码
    console.log('获取预生成用户编码')
    await self.BANK_SIGN_GET_PRODINSTID({
      params: {},
      self: self,
      config: {
        loadingShow: true,
        loadingHide: true,
        loadingShowMsg: '正在获取用户编码'
      }
    }).then(res => {
      // 存储用户编码
      self.ORDER_PARAM_SET_PRODINSTID(res.prodInstId)
    })
    if (self.prodInstId === '') return
  }
  console.log('获取签约验证码')
  self.BANK_SIGN_GET_AUTH_CODE({
    params: {
      servId: self.prodInstId,
      bankId: self.params.bank,
      bankAcctId: self.params.bankNo,
      bankAcctName: self.params.acctName
    },
    self: self,
    config: {
      loadingShow: true,
      loadingHide: true,
      loadingShowMsg: '正在获取签约验证码'
    }
  }).then(res => {
    self.$vux.alert.show({
      title: '操作确认',
      content: '已发送托收签约短信，请客户查收。',
      onShow () {},
      onHide () {}
    })
  })
},
//切换银行
changeBank (value) {
  let self = this
  if (self.isInit) {
    self.isInit = false
    return
  }
  self.change(value, 'bank')
  // 当前银行是建行 选择其他银行时触发解约
  // gyf add 用户id不为空时触发
  if (self.orderParamInfo.bank === '604' && self.prodInstId !== '') {
    console.log('是否进入选择银行')
    self.changeBankByAgreement()
  }
},
    
//具体解约方法
async changeBankByAgreement () {
  let self = this
  console.log('查询银行签约信息')
  await self.BANK_SIGN_QUERY_ENTRUST({
    params: {
      bankId: self.orderParamInfo.bank,
      bankAcctId: self.orderParamInfo.bankNo,
      // gyf add 增加servId入参
      servId: self.prodInstId
    },
    self: self,
    config: {
      loadingShow: true,
      loadingHide: true,
      loadingShowMsg: '正在查询银行签约信息'
    }
  }).then(async res => {
    console.log('查询签约状态数据:', res)
    // 对relationList数组进行筛选
    let temp = res.relationList.filter(item => {
      if (item.servId === self.prodInstId) {
        return item
      }
    })
    if (temp[0].state === '正常') { // 已生效
      if (self.params.bank === self.orderParamInfo.bank) {
        // 是同一家银行
        if (self.params.bankNo === self.orderParamInfo.bankNo) {
          // 是同一个卡号
          console.log('同一个卡号,不解约')
          self.$vux.toast.show({
            text: '托收银行已签约，请直接返回',
            width: '16em',
            type: 'text',
            position: 'top'
          })
          self.isReady = false
        } else {
          // 不是同一个卡号,先解约
          console.log('不是同一个卡号,解约')
          await self.BANK_SIGN_UNSIGN({
            params: {
              servId: self.prodInstId,
              bankId: self.orderParamInfo.bank,
              bankAcctId: self.orderParamInfo.bankNo
            },
            self: self,
            config: {
              loadingShow: true,
              loadingHide: true,
              loadingShowMsg: '正在解约，请稍候'
            }
          }).then(res => {
            if (res.retCode === '08') {
              // 解约不成功，仍然为原卡号
              self.params.bankNo = self.orderParamInfo.bankNo
              self.isReady = false
            } else {
              // gyf add 解约后删除servId
              self.ORDER_PARAM_DEL_PRODINSTID()
            }
          })
        }
      } else {
        // 不是同一家银行，先解约
        console.log('不是同一家银行,解约')
        await self.BANK_SIGN_UNSIGN({
          params: {
            servId: self.prodInstId,
            bankId: self.orderParamInfo.bank,
            bankAcctId: self.orderParamInfo.bankNo
          },
          self: self,
          config: {
            loadingShow: true,
            loadingHide: true,
            loadingShowMsg: '正在解约，请稍候'
          }
        }).then(res => {
          if (res.retCode === '08') {
            // 解约不成功，仍然为建行
            self.params.bank = self.orderParamInfo.bank
            self.params.bankNo = self.orderParamInfo.bankNo
            self.isReady = false
          } else {
            // gyf add 解约后删除servId
            self.ORDER_PARAM_DEL_PRODINSTID()
          }
        })
      }
    }
  })
},
```







### 建行查询托收(通过then返回进行判断)

```js
queryEntrust () {
      let self = this
      if (self.params.bankId === '604') {
        console.log('查询银行签约信息')
        // !important gyf add 此处添加return才能通过await获取true或false
        return self.BANK_SIGN_QUERY_ENTRUST({
          params: {
            bankId: self.collectionRelationList[self.collectionRelationIndex].bankCode,
            bankAcctId: self.collectionRelationList[self.collectionRelationIndex].bankAcctId,
            // gyf add 增加servId入参
            servId: self.collectionRelationList[self.collectionRelationIndex].servId
          },
          self: self,
          config: {
            loadingShow: true,
            loadingHide: true,
            loadingShowMsg: '正在查询银行签约信息'
          }
        }).then(res => {
          console.log('gyf签约查询', res)
          let temp = res.relationList.filter(item => {
            if (item.servId === self.prodInstId) {
              return item
            }
          })
          console.log('gyf筛选查询', temp)
          // self.validType = temp[0].state === '解约' ? '已失效' : ''
          // gyf add直接获取是否是正常的状态值
          self.distrust = temp[0].state === '正常'
          // 除了正常和解约的其他状态 都不调解约接口
          if (temp[0].state !== '正常' && temp[0].state !== '解约') {
            console.log('状态是其他中间值')
            self.$vux.toast.show({
              text: '原托收银行正在进行托收解约，请稍后再试',
              width: '22em',
              type: 'text',
              position: 'top'
            })
            self.validType = temp[0].state // 直接把状态值赋给validType
            return false
          } else if (temp[0].state === '解约') {
            self.validType = '已失效'
            // validType == 已失效 不执行后续解约操作 返回false
            self.params.agreementNo = res.agreeNo
            console.log('状态是解约')
              // 关键返回语句
            return false
          } else {
            // 关键返回语句 正常状态 走解约流程
            return true
          }
          // return true
        }, error => {
          console.log(error)
          console.log('执行了error')
          self.$vux.toast.show({
            text: error.message,
            width: '22em',
            type: 'text',
            position: 'top'
          })
          console.log('执行了错误返回false')
          return false
        })
      }
    },
```





### 电网项目

#### 点击左侧工作区激活右侧路由

```vue
<!--index.vue主页  通过自定义事件clickItem逐级传递data参数给主页面-->
<ai-aside @click-item="clickItem" @preview="preview"></ai-aside>
  <el-main>
      <!--关键值：activeTab 即激活的当前页面-->
    <el-tabs class="ai-main-tabs" v-model="activeTab" closable @tab-click="tabClick" @tab-remove="tabRemove">
      <el-tab-pane v-for="item in tabs" :key="item.routeName" :label="item.label" :name="item.routeName" style="height:100%;">
        <router-view class="router-view" :name="item.routeName"></router-view>
      </el-tab-pane>
    </el-tabs>
  </el-main>
 <script>
     export default {
         methods: {
             /*  点击el-tree产生的节点数据 一层层传递给el-tab-pane
              { icon:ai-team-work,
             	label:'年度综合生产计划',
             	routeName: 'yearplan',
             	url:'/teamwork/yearplan'
               }
             */
             clickItem(data){  //接收子组件el-tree层层传过来的对象,包含了url跳转路径
                 //1. 先判断tabs中是否有该页面
                 this.addTab(data)
                 //2. 触发激活tabs的事件,展示刚选中的tab
                 this.tabClick(data)
             },
             //激活对应的tabs页
             tabClick(data){
                 let result = ''
                 for(let item of this.tabs){
                     if(item.routeName === data.routeName){
                         result = data
                         break
                     }
                 }
                 if(this.$router.currentPath !== result.url){
                     // 跳转到对应路由页
                     this.$router.push(result.url)
                 }
                 // 激活对应的activeTab
                 this.activeTab = result.routeName
             },
             addTab(data){
                 // tabs没有该页面，添加到tabs数组中
               if(!this.hasTab(data)){
                   this.tabs.push(data)
               }
             },
             hasTab(data){
                 for(let item of this.tabs){
                   if(item.routeName === data.routeName) return true
               }  
                 return false
             },
         }
     }
 </script>
```

