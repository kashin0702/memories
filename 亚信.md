### vuex-封装

```js
//  store/index.js主文件，通过module独立封装各个store子模块
import Vue from 'vue'
import Vuex from 'vuex'
import enums from './modules/enums'
import page from './modules/page'
import operator from './modules/operator'
Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    enums: enums,
    page: page,
    operator: operator
  }
})

```

modules 子模块:

```js
//module enums为例
import {
  //这些都是提前定义的一些常量字段
  ENUMS_GET_KEY_VALUE,
  ENUMS_GET_NAME,
  ENUMS_SET_DATA
} from '../mutation-types'

const state = {
  data: {} // 枚举值数据对象
}
//**getters相当于store的计算属性，接受state作为第一个参数
const getters = {
    //常量字段作为getters方法名
  [ENUMS_GET_KEY_VALUE] (state) {
    return typeCode => {
      let arr = []
      for (let i in state.data[typeCode]) {
        arr.push({
          key: state.data[typeCode][i].enumValue,
          value: state.data[typeCode][i].enumName
        })
      }
      return arr
    }
  },
  [ENUMS_GET_NAME] (state) {
    return (value, typeCode) => {
      for (let i in state.data[typeCode]) {
        if (state.data[typeCode][i].enumValue === value) {
          return state.data[typeCode][i].enumName
        }
      }
      return ''
    }
  }
}

const mutations = {
  [ENUMS_SET_DATA] (state, data) {
    state.data = data
  }
}

const actions = {}

export default {
  state,
  getters,
  mutations,
  actions
}
```

### api封装

```js
import axios from 'axios'
import router from '@/router'
import constant from '@/data/constant'
import {LocalStorageFactory} from '@/utils/localstorage.factory'

axios.defaults.withCredentials = true
axios.defaults.baseURL = window.config.baseUrl
axios.defaults.headers = {
  'Content-Type': 'application/json'
}

axios.interceptors.request.use(config => {
  let accessToken = LocalStorageFactory.get('ACCESS_TOKEN')
  // 如果没有accessToken且不在登录界面，则跳转到登录界面
  if (!accessToken && router.currentRoute.fullPath !== '/') {
    router.push('/')
  }
  config.headers.accessToken = accessToken
  return config
}, err => {
  return Promise.reject(err)
})

//通用api方法
function axiosApi (method, url, params, self, config, success, fail, error) {
  // 默认配置
  if (!config) {
    config = {
      loadingShow: false,
      loadingHide: false,
      loadingShowMsg: ''
    }
  }
  // 提示信息展示
  if (config.loadingShow) {
    window.isLoading = true
    self.$vux.loading.show({
      text: config.loadingShowMsg
    })
  }
  // 请求信息打印
  console.log(url)
  console.log(params)
  return axios({
    method: method,
    url: url,
    data: method === 'POST' || method === 'PUT' ? params : null,
    params: method === 'GET' || method === 'DELETE' ? params : null,
    withCredentials: true
  }).then(function (res) {
    window.isLoading = false
    // 提示信息隐藏
    if (config.loadingHide) {
      self.$vux.loading.hide()
    }
    if (res.data[window.config.RETURN_CODE] === window.config.SUCCESS_CODE || res.data[window.config.PAPERLESS_RETURN_CODE] === window.config.PAPERLESS_SUCCESS_CODE) {
      // 请求结果成功操作
      if (success) {
        success(res.data)
      }
    } else {
      // 请求结果失败操作
      if (fail) {
        fail(res.data)
      }
    }
    // 结果信息打印
    console.log(res)
  }).catch(function (err) {
    window.isLoading = false
    // 提示信息隐藏
    self.$vux.loading.hide()
    self.$vux.toast.show({
      text: constant.LOADING_MSG_NET_ERROR,
      width: '10em',
      type: 'text',
      position: 'top'
    })
    if (error) {
      // 请求异常操作
      error(err)
    }
    // 异常信息打印
    console.log(err)
  })
}

// 提供再次封装的GET、POST、PUT、DELETE方法
export default {
  get: function (url, params, self, config, success, fail, error) {
    return axiosApi('GET', url, params, self, config, success, fail, error)
  },
  post: function (url, params, self, config, success, fail, error) {
    return axiosApi('POST', url, params, self, config, success, fail, error)
  },
  put: function (url, params, self, config, success, fail, error) {
    return axiosApi('PUT', url, params, self, config, success, fail, error)
  },
  delete: function (url, params, self, config, success, fail, error) {
    return axiosApi('DELETE', url, params, self, config, success, fail, error)
  }
}
```

### 歌华银行签约查询接口

```js
//api方法
pubBankQryEntrustZg :function(params, self, config, success, fail, error) {
    return ajax.post(eiOspAccountBasePath + '/pubBankQryEntrustZg', params, self, config, success, fail, error)
  },
      
 // vuex对象内的异步方法 store/modules/bankSign.js
 // 14.15 银行签约查询通用接口
const actions = {
     [BANK_SIGN_QUERY_ENTRUST] ({commit, rootState}, args) {
    return new Promise(function (resolve, reject) {
      eiOspAPI.pubBankQryEntrustZg(args.params, args.self, args.config, res => {
        resolve(res.data)
      }, err => {
        args.self.$vux.toast.show({
          text: err[window.config.RETURN_MESSAGE],
          width: '14em',
          type: 'text',
          position: 'top'
        })
        reject(err)
      })
    })
  },
    //14.13 银行解约通用接口
    [BANK_SIGN_UNSIGN] ({commit, rootState}, args) {
    return new Promise(function (resolve, reject) {
      eiOspAPI.pubBankUnsignZg(args.params, args.self, args.config, res => {
        resolve(res.data)
      }, err => {
        args.self.$vux.toast.show({
          text: err[window.config.RETURN_MESSAGE],
          width: '14em',
          type: 'text',
          position: 'top'
        })
        reject(err)
      })
    })
  },
}
 
```

```js
//页面具体调用
this.BANK_SIGN_UNSIGN({
    params: {
      servId: self.prodInstId,
      bankId: self.orderParamInfo.bank,
      bankAcctId: self.orderParamInfo.bankNo
    },
    self: self,
    config: {
      loadingShow: true,
      loadingHide: true,
      loadingShowMsg: '正在解约，请稍候'
    }
  }).then(res => {
    if (res.retCode === '08') {
      // 解约不成功，仍然为原卡号
      self.params.bankNo = self.orderParamInfo.bankNo
      self.isReady = false
    } else {
      // gyf add 解约后删除servId
      self.ORDER_PARAM_DEL_PRODINSTID()
    }
  })
```





### 接口调用例子

```js
//封装订单提交接口
export const payAPI = {
    createPayOrder (requestId, params, self, config, success, fail, error) {
    return ajax.post(payServerBasePath + '/createPayOrder/' + requestId, params, self, config, success, fail, error)
  },
}

//具体调用
payAPI.createPayOrder(self.payRequestId, {
    totalBizType: 'BIZ00846',
    userKind: '5',
    userNo: self.resultDetailOrderParamBo.pdfInfoBo.custCode,
    requestId: self.payRequestId,
    payVia: self.orderParamOther.payMethod === '25' ? '66' : '56',
    amount: self.resultDetailTotalReceipts,
    payChannel: self.orderParamOther.payMethod === '25' ? 'weixin_1' : 'alipay_3',
    payType: self.orderParamOther.payMethod,
    subject: '融合业务新装',
    useCouponCode: '101',
    parperOrderNo: self.resultDetailOrderParamBo.businessInfoBo.orderId
  }, self, {
    loadingShow: true,
    loadingHide: true,
    loadingShowMsg: '生成支付二维码'
  }, res => {
    if (self.broadbandIsHigh) {
      // 高宽带派单
      payAPI.highKd(self.payRequestId, {
        custId: self.customerList[self.customerIndex].custId,
        offerName: self.broadbandOfferName,
        custOrderId: self.resultDetailOrderParamBo.businessInfoBo.orderId,
        mobilePhone: self.broadbandPhone,
        remark: '',
        kindName: self.broadbandKindName
      }, self)
    }
    self.PAY_SET_QR_CODE(res.data.qrCode)
    self.PAY_SET_AMOUNT(res.data.sumPay)
    self.PAY_SET_TYPE(self.orderParamOther.payMethod === '25' ? '1' : '0')
    self.PAY_SET_PATH('/main/' + self.pageSelectTabKey)
    self.$router.push('/fusenew/qrcode/pay')
  }, err => {
        self.$vux.toast.show({
          text: err[window.config.PAPERLESS_RETURN_MESSAGE],
          width: '20em',
          type: 'text',
          position: 'top'
        })
    })
```



### 歌华优惠码校验逻辑

```js
//点击卡号后校验顺序
//1.getCardPwd接口获取卡密 
//2.返回结果中入参卡密，调用cardPwdValidate 校验卡密是否可用
//3.返回结果再调couponCodeCheckToPhone 校验该卡密该用户该套餐是否可用
```

